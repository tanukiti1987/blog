<p>Railsで、viewファイルに対して、<code class="highlighter-rouge">javascript_include_tag</code> や <code class="highlighter-rouge">stylesheet_link_tag</code> を多重に読み込んでしまうような書き方をしてしまうことって、ありますよね。</p>

<p>重複して css や js ファイルを読み込んでしまうことで、スタイルが壊れてしまったり、jsの動きがおかしくなってしまったり。。。などなど、困ることも多いです。</p>

<p>content_for_once はそれを解決するための gem です。</p>

<h2 id="content_for_once">content_for_once</h2>

<p><code class="highlighter-rouge">content_for_once</code> というフレーズをグーグルなどで検索していみると、 <a href="http://blog.s21g.com/articles/203">この記事</a> にあたるのですが、私の記事で紹介する内容は、呼び名こそ同じものの、少し動きを変えております。</p>

<p>先ほどの記事では Rails に対してライブラリを追加するとき <code class="highlighter-rouge">script/plugin</code> というコマンドによりライブラリを追加するのが標準だった頃の内容でした。(ボクはその時代のRailsをよく知らない。。)</p>

<p>現在ではみなさんもお馴染みのgemによるライブラリの配布が主流になり、この配布の形に乗せて、似たようなものを使いたい。という思いがありました。</p>

<p>https://rubygems.org/gems/content_for_once</p>

<p>命名に関してですが、<code class="highlighter-rouge">content_for_once</code> という名前でプラグインをブログ記事を書かれている方がいたのですが、<code class="highlighter-rouge">content_for_once</code> いい名前だよな。。というのと、オリジナルの <code class="highlighter-rouge">content_for_once</code> はpluginの形で公表されているものの、ソースコード自体はもうリンク切れになっており、流通も少なそうな雰囲気を受けたので、オリジナル作者の方に連絡をして、名前やら処理の内容を変更することに許可を頂き、<code class="highlighter-rouge">content_for_once</code> という名前をつけました。</p>

<h2 id="使いかた">使いかた</h2>

<div class="language-haml highlighter-rouge"><pre class="highlight"><code><span class="c">-# app/views/layout/application.html.haml
</span><span class="p">=</span> <span class="k">yield</span> <span class="ss">:css</span>

<span class="c">-# articles/index.html.haml
</span><span class="p">-</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span>
  <span class="p">=</span> <span class="n">render</span> <span class="s1">'article'</span><span class="p">,</span> <span class="ss">article: </span><span class="n">article</span>

<span class="c">-# articles/_article.html.haml
</span><span class="p">-</span> <span class="n">content_for_once</span> <span class="ss">:css</span> <span class="k">do</span>
  <span class="p">=</span> <span class="n">stylesheet_link_tag</span> <span class="s1">'article'</span>

<span class="nc">.article</span>
  <span class="nc">.title</span><span class="p">=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span>
</code></pre>
</div>

<p>こんな感じに、 <code class="highlighter-rouge">index.html.haml</code> と <code class="highlighter-rouge">_article.html.haml</code> に同じcssを読み込むような記述を書いたとしても、従来の <code class="highlighter-rouge">content_for</code> では2つの <code class="highlighter-rouge">&lt;link rel="stylesheet" href="article.css"&gt;</code> が挿入されてしまうところ、 <code class="highlighter-rouge">content_for_once</code> を使えば、1度だけの挿入で済むようになります。</p>

<h2 id="まとめ">まとめ</h2>

<p>もしよろしければ、ご利用頂いたり、PRやissue などでアドバイスいただければと思います mm</p>
